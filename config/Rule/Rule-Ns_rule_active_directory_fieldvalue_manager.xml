<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Rule language="beanshell" name="NS_Rule_Active_Directory_FieldValue_Manager" type="FieldValue">
  <Description>
    This rule can be used to generate a field value using data from the given Identity.
  </Description>
  <ReferencedRules>
    <Reference class="sailpoint.object.Rule" name="NS_Global_RuleLibrary_Utils"/>
  </ReferencedRules>
  <Signature returnType="String">
    <Inputs>
      <Argument name="log">
        <Description>The log object associated with the SailPoint context.</Description>
      </Argument>
      <Argument name="context">
        <Description>A sailpoint.api.SailPointContext object that can be used to query the database if necessary.</Description>
      </Argument>
      <Argument name="identity" type="Identity">
        <Description>The Identity object that represents the user needing the field value.</Description>
      </Argument>
      <Argument name="link" type="Link">
        <Description>The sailpoint.object.Link that is being acted upon. If the link is not applicable, this value will be null.</Description>
      </Argument>
      <Argument name="application" type="Application">
        <Description>The sailpoint.object.Application with the template we are compiling. 
        If the application is not applicable, the value will be null.</Description>
      </Argument>
    </Inputs>
    <Returns>
      <Argument name="value">
        <Description>The string value created.</Description>
      </Argument>
    </Returns>
  </Signature>
  <Source>
    import sailpoint.object.IdentityService;
    import sailpoint.object.Link;
    import sailpoint.object.Application;
    import sailpoint.object.Identity;
    import sailpoint.api.IdentityService;
	  import org.apache.log4j.Logger;

    Logger logs = Logger.getLogger("com.rule.NS_Rule_Active_Directory_FieldValue_Manager");
    logs.debug("Enter SR_Rule_Active_Directory_FieldValue_Manager");

    String managerDN = null;
    Link managerLink = null;
  //return managerDN;
    IdentityService identityService = new IdentityService(context);
   // System.out.println("identity;;;;"+identity.toXml());
  // System.out.println("manager;;;;"+manager.toXml());
    try {
        if (identity != null &amp;&amp; identity != void) {
            String appName = null;
          Identity manager = identity.getManager();
            if (application != void &amp;&amp; application instanceof Application) {
                appName = (String) application.getName();
            //  System.out.println("appName;;;;;;;;;;;;;;;;;;;"+appName);
            }
            logs.debug("Application name: " + appName);

            if (manager != null) {
                Link managerAdLink = getADAccountLink(manager.getName());
              //   System.out.println("managerAdLink;;;;"+managerAdLink.toXml());
                if (managerAdLink != null) {
                    managerDN = managerAdLink.getAttribute("distinguishedName");
                    logs.debug("manager DN = " + managerDN);
                  System.out.println("manager DN = " + managerDN);
                }
            } else {
                logs.debug("Identity has no manager");
            }
        } else {
            logs.debug("Identity is null");
        }
    } catch (Exception ex) {
        logs.error("Exception", ex);
    }

    logs.debug("Exit NS_Rule_Active_Directory_FieldValue_Manager");
    return managerDN;
  </Source>
</Rule>